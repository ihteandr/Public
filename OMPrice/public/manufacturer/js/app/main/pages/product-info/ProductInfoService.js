define(["Class"],function(e){var t=e.extend({$http:null,$q:null,init:function(e,t){this.$http=e,this.$q=t},_doRequest:function(e,t){var i=this.$q.defer();return this.$http.get(e,{params:t}).success(function(e){if("success"==e.status){var t;t=e.data&&e.data.products?e.data.products[0]:e.data,i.resolve(t)}else i.reject(e)}).error(function(e){i.reject(e)}),i.promise},getProduct:function(e){var t,i={full:!0};return e._id?t="/products/"+e._id:(t="/products",e.ean?i.ean=e.ean:i.name=e.name),this._doRequest(t,i)},getTmpProduct:function(e){return this._doRequest("/product/tmp/"+e)},getMarkets:function(){return this._doRequest("/markets")},getSections:function(e){var t=this.$q.defer(),i=this;return this.getSections.timeout&&clearTimeout(this.getSections.timeout),this.getSections.timeout=setTimeout(function(){i._doRequest("/sections",{market:e}).then(t.resolve,t.reject),clearTimeout(i.getSections.timeout)},500),t.promise},getCategories:function(e){var t=this.$q.defer(),i=this;return this.getCategories.timeout&&clearTimeout(this.getCategories.timeout),e?this.getCategories.timeout=setTimeout(function(){i._doRequest("/categories",{section:e}).then(t.resolve,t.reject),clearTimeout(i.getCategories.timeout)},500):t.resolve([]),t.promise},getFamilies:function(e){var t=this.$q.defer(),i=this;return this.getFamilies.timeout&&clearTimeout(this.getFamilies.timeout),e?this.getFamilies.timeout=setTimeout(function(){i._doRequest("/families",{category:e}).then(t.resolve,t.reject),clearTimeout(i.getFamilies.timeout)},500):t.resolve([]),t.promise},getCountries:function(){return this._doRequest("/countries",{full:!0})},getBrands:function(){return this._doRequest("/brands")},getBulkUnits:function(){return this._doRequest("/bulkUnits")},saveProduct:function(e,t){var i=e.product,s=e.newImages,n={transformRequest:angular.identity,headers:{"Content-Type":void 0}},r=new FormData;t?(n.url="/products/tmp",n.method="POST"):(n.url="/products/tmp/"+i.ean,n.method="PUT");for(var o in s)r.append("file"+o,s[o].file,"file"+o);i._id&&"undefined"!=i._id&&r.append("_id",i._id),i.name&&"undefined"!=i.name&&r.append("name",i.name),r.append("category",i.category),r.append("details",JSON.stringify(i.details)),r.append("ean",i.ean),r.append("family",i.family),r.append("market",i.market),r.append("section",i.section),i.status&&"undefined"!=i.status&&r.append("status",i.status),n.data=r;var u=this.$q.defer();return this.$http(n).success(function(e){"success"==e.status?u.resolve(e.data):u.reject(e)}).error(u.reject),u.promise}});return t.$inject=["$http","$q"],t});