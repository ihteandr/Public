define(["jquery","BaseController","BootstrapGrowl","Bootstrap"],function(t,e){var i=e.extend({_model:null,_spinService:null,$routeParams:null,$location:null,query:{},init:function(e,i,s,o,c){this._super(e);var r=this;if(this._model=o,this._spinService=c,this.$location=s,this._model.setStorage(this.$scope),this._model.storage.newImages=[],i.idOrEanOrName){var d=i.idOrEanOrName,a={};/^[\d,]+$/.test(d)?a.ean=d:/^([a-z]|[0-9])+$/.test(d)?a._id=d:a.name=d,setTimeout(function(){r._spinService.startSpin(t("form.not-initialized")[0])},200),this._model.fetchProduct(a).then(function(){r._model.fetchTmpProduct(a.ean).then(function(){r._spinService.stopSpin(),r._model.get("tmpProduct").ean?r._model.set("currentProduct",r._model.get("tmpProduct")):r._model.set("currentProduct",r._model.get("product")),r._model.get("product")&&(r._model.get("currentProduct").images=r._model.get("product").images)})})}else this.$scope.product={},this.$scope.tmpProduct={},this.$scope.currentProduct={details:{nutritional:{}}},this._model.isNew=!0;this._model.fetchMarkets(),this._model.fetchCountries(),this._model.fetchBrands(),this._model.fetchBulkUnits()},checkName:function(){return this._model.get("tmpProduct").name&&this._model.get("product").name!=this._model.get("tmpProduct").name?!0:!1},checkMarket:function(){return this._model.get("tmpProduct").market&&this._model.get("product").market!=this._model.get("tmpProduct").market?!0:!1},checkSection:function(){return this._model.get("tmpProduct").section&&this._model.get("product").section!=this._model.get("tmpProduct").section?!0:!1},checkCategory:function(){return this._model.get("tmpProduct").category&&this._model.get("product").category!=this._model.get("tmpProduct").category?!0:!1},checkFamily:function(){return this._model.get("tmpProduct").family&&this._model.get("product").family!=this._model.get("tmpProduct").family?!0:!1},checkDetailsBulk:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.bulk!=this._model.get("tmpProduct").details.bulk?!0:!1},checkDetailsBulkUnit:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.bulkUnit!=this._model.get("tmpProduct").details.bulkUnit?!0:!1},checkDetailsBrandName:function(){if(this._model.get("tmpProduct").details){if(!this._model.get("product").details.brand&&!this._model.get("tmpProduct").details.brand)return!1;if(!this._model.get("product").details.brand&&this._model.get("tmpProduct").details.brand)return!0;if(this._model.get("product").details.brand.name!=this._model.get("tmpProduct").details.brand.name)return!0}return!1},checkDetailsManufacturer:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.manufacturer!=this._model.get("tmpProduct").details.manufacturer?!0:!1},checkDetailsCountry:function(){if(this._model.get("tmpProduct").details){if(!this._model.get("product").details.country&&!this._model.get("tmpProduct").details.country)return!1;if(!this._model.get("product").details.country&&this._model.get("tmpProduct").details.country)return!0;if(this._model.get("product").details.country._id!=this._model.get("tmpProduct").details.country._id)return!0}return!1},checkDetailsAddress:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.address!=this._model.get("tmpProduct").details.address?!0:!1},checkDetailsWebsite:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.website!=this._model.get("tmpProduct").details.website?!0:!1},checkDetailsPhone:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.phone!=this._model.get("tmpProduct").details.phone?!0:!1},checkDetailsEmail:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.email!=this._model.get("tmpProduct").details.email?!0:!1},checkDetailsSummary:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.summary!=this._model.get("tmpProduct").details.summary?!0:!1},checkDetailsConsist:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.consist!=this._model.get("tmpProduct").details.consist?!0:!1},checkDetailsNutritionalFat:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.nutritional.fat!=this._model.get("tmpProduct").details.nutritional.fat?!0:!1},checkDetailsNutritionalProtein:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.nutritional.protein!=this._model.get("tmpProduct").details.nutritional.protein?!0:!1},checkDetailsNutritionalCarbohydrates:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.nutritional.carbohydrates!=this._model.get("tmpProduct").details.nutritional.carbohydrates?!0:!1},checkDetailsNutritionalCaloric:function(){return this._model.get("tmpProduct").details&&this._model.get("product").details.nutritional.caloric!=this._model.get("tmpProduct").details.nutritional.caloric?!0:!1},checkStatus:function(){return this._model.get("tmpProduct").status&&this._model.get("product").status!=this._model.get("tmpProduct").status?!0:!1},defineScope:function(){this.$scope.currentProduct={isNotInitialized:!0},this.$scope.checkName=this.checkName.bind(this),this.$scope.checkMarket=this.checkMarket.bind(this),this.$scope.checkSection=this.checkSection.bind(this),this.$scope.checkCategory=this.checkCategory.bind(this),this.$scope.checkFamily=this.checkFamily.bind(this),this.$scope.checkDetailsBulk=this.checkDetailsBulk.bind(this),this.$scope.checkDetailsBulkUnit=this.checkDetailsBulkUnit.bind(this),this.$scope.checkDetailsManufacturer=this.checkDetailsManufacturer.bind(this),this.$scope.checkDetailsCountry=this.checkDetailsCountry.bind(this),this.$scope.checkDetailsAddress=this.checkDetailsAddress.bind(this),this.$scope.checkDetailsWebsite=this.checkDetailsWebsite.bind(this),this.$scope.checkDetailsPhone=this.checkDetailsPhone.bind(this),this.$scope.checkDetailsEmail=this.checkDetailsEmail.bind(this),this.$scope.checkDetailsSummary=this.checkDetailsSummary.bind(this),this.$scope.checkDetailsConsist=this.checkDetailsConsist.bind(this),this.$scope.checkDetailsNutritionalCaloric=this.checkDetailsNutritionalCaloric.bind(this),this.$scope.checkDetailsNutritionalCarbohydrates=this.checkDetailsNutritionalCarbohydrates.bind(this),this.$scope.checkDetailsNutritionalProtein=this.checkDetailsNutritionalProtein.bind(this),this.$scope.checkDetailsNutritionalFat=this.checkDetailsNutritionalFat.bind(this),this.$scope.checkStatus=this.checkStatus.bind(this),this.$scope.submit=this.submit.bind(this),this.$scope.back=this.back.bind(this)},__handleMarketChange:function(t,e){t!==e&&(this._model.fetchSections(),this._model.fetchCategories(),this._model.fetchFamilies())},__handleSectionChange:function(t,e){t!==e&&(this._model.fetchCategories(),this._model.fetchFamilies())},__handleCategoryChange:function(t,e){t!==e&&this._model.fetchFamilies()},defineListeners:function(){this._super(),this.$scope.$watch("currentProduct.market",this.__handleMarketChange.bind(this)),this.$scope.$watch("currentProduct.section",this.__handleSectionChange.bind(this)),this.$scope.$watch("currentProduct.category",this.__handleCategoryChange.bind(this))},validate:function(){var e=["family","section","category","market"],i=!0;this._model.get("product").ean||this._model.get("tmpProduct").ean?t("#"+e[s]).removeClass("error"):(t("#"+e[s]).addClass("error"),i=!1);for(var s=1,o=e.length;o>s;s++)this._model.get("currentProduct")[e[s]]?t("#"+e[s]).removeClass("error"):(t("#"+e[s]).addClass("error"),i=!1);return i},submit:function(){var e=this;this.validate()&&this._model.save().then(function(i){i.images&&(e._model.get("currentProduct").images=i.images),e._model.set("newImages",[]),e.$scope.$broadcast("resetUploader"),t.growl({message:"Изменения Сохранены"},{type:"success"})})},back:function(){this.$location.path("/home")}});return i.$inject=["$scope","$routeParams","$location","ProductInfoModel","SpinService"],i});