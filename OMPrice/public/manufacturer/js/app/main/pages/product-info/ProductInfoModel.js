define(["Class","BaseModel"],function(t,e){var r=e.extend({_service:null,isNew:!1,init:function(){},fetchSections:function(){var t=this;return this._service.getSections(this.storage.currentProduct.market).then(function(e){t.storage.sections=e;var r=_.find(t.storage.sections,function(e){return e._id==t.storage.currentProduct.section});r||(t.storage.currentProduct.section="",t.storage.currentProduct.category="",t.storage.currentProduct.family="")})},fetchCategories:function(){var t=this;return""==this.storage.currentProduct.section&&(this.storage.categories=[],this.storage.currentProduct.family=""),this._service.getCategories(this.storage.currentProduct.section).then(function(e){t.storage.categories=e;var r=_.find(t.storage.categories,function(e){return e._id==t.storage.currentProduct.category});r||(t.storage.currentProduct.category="",t.storage.currentProduct.family="")})},fetchFamilies:function(){var t=this;""==this.storage.currentProduct.category&&(this.storage.families=[]),this._service.getFamilies(this.storage.currentProduct.category).then(function(e){t.storage.families=e})},fetchMarkets:function(){var t=this;return this._service.getMarkets().then(function(e){t.storage.markets=e})},fetchTmpProduct:function(t){var e=this;return this._service.getTmpProduct(t||this.storage.product.ean).then(function(t){t?e.storage.tmpProduct=t.product:(e.storage.tmpProduct={},e.isNew=!0)})},fetchProduct:function(t){var e=this;return this._service.getProduct(t).then(function(t){e.storage.product=t||{}})},fetchCountries:function(){var t=this;return this._service.getCountries().then(function(e){t.storage.countries=e})},fetchBrands:function(){var t=this;return this._service.getBrands().then(function(e){t.storage.brands=e})},fetchBulkUnits:function(){var t=this;return this._service.getBulkUnits().then(function(e){t.storage.bulkUnits=e})},save:function(){var t=[],e=[];this.get("tmpProduct").ean&&(t=this.get("tmpProduct").ean.split(",")),this.get("product").ean&&(e=this.get("product").ean.split(","));var r=_.clone(this.get("currentProduct"),!0);return r.ean=_.union(e,t).join(","),console.log("new images ",this.get("newImages")),this._service.saveProduct({product:r,newImages:this.storage.newImages},this.isNew)}}),n=t.extend({instance:new r,$get:["ProductInfoService",function(t){return this.instance._service=t,this.instance}]});return n});